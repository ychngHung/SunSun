<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Plist Generator</title>
</head>
<body>
    <h1>Dynamic .plist Generator</h1>
    <form id="plistForm">
        <label for="app">App Name (app):</label>
        <input type="text" id="app" name="app" placeholder="AppName" required><br><br>

        <label for="id">Bundle Identifier (id):</label>
        <input type="text" id="id" name="id" placeholder="bundle-ID" required><br><br>

        <button type="submit">Generate Download Link</button>
    </form>

    <h2>Generated Link:</h2>
    <div id="result"></div>

    <script>
        document.getElementById('plistForm').addEventListener('submit', function (event) {
            event.preventDefault();

            // 獲取用戶輸入的值
            const app = document.getElementById('app').value;
            const bundleId = document.getElementById('id').value;

            // 構造 IPA 文件 URL，並附加 .ipa 後綴
            const ipaUrl = `https://ychnghung.github.io/SunSun?app=${encodeURIComponent(app)}&id=${encodeURIComponent(bundleId)}.ipa`;

            // 構造 .plist 文件內容
            const plistContent = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>items</key>
    <array>
        <dict>
            <key>assets</key>
            <array>
                <dict>
                    <key>kind</key>
                    <string>software-package</string>
                    <key>url</key>
                    <string>${ipaUrl}</string>
                </dict>
            </array>
            <key>metadata</key>
            <dict>
                <key>bundle-identifier</key>
                <string>${bundleId}</string>
                <key>bundle-version</key>
                <string>1.0.0</string>
                <key>kind</key>
                <string>software</string>
                <key>title</key>
                <string>${app}</string>
            </dict>
        </dict>
    </array>
</dict>
</plist>`;

            // 創建 Blob 文件
            const blob = new Blob([plistContent], { type: 'application/xml' });

            // 創建下載鏈接
            const plistUrl = URL.createObjectURL(blob);
            const downloadLink = document.createElement('a');
            downloadLink.href = plistUrl;
            downloadLink.download = `${app}-manifest.plist`;
            downloadLink.textContent = 'Download .plist File';
            downloadLink.style.display = 'block';

            // 添加到結果區域
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = ''; // 清空之前的結果
            resultDiv.appendChild(downloadLink);

            // 顯示 itms-services 協議鏈接
            const itmsLink = document.createElement('p');
            itmsLink.innerHTML = `Install Link: <a href="itms-services://?action=download-manifest&url=${ipaUrl}" target="_blank">Install App</a>`;
            resultDiv.appendChild(itmsLink);
        });
    </script>
</body>
</html>
