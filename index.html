<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install Ｐage</title>
    <script>
        window.onload = function () {
            // 獲取當前網址的查詢參數
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);

            // 提取 app 和 id 參數
            const app = urlParams.get('app');
            const bundleID = urlParams.get('id');

            if (app && bundleID) {
                // 構造 IPA 文件的 URL
                const ipaUrl = `https://ychnghung.github.io/SunSun/${encodeURIComponent(app)}`

                // 構造 .plist 文件的內容
                const plistContent = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>items</key>
    <array>
        <dict>
            <key>assets</key>
            <array>
                <dict>
                    <key>kind</key>
                    <string>software-package</string>
                    <key>url</key>
                    <string>${ipaUrl}.ipa</string>
                </dict>
            </array>
            <key>metadata</key>
            <dict>
                <key>bundle-identifier</key>
                <string>${bundleID}</string>
                <key>bundle-version</key>
                <string>1.0.0</string>
                <key>kind</key>
                <string>software</string>
                <key>title</key>
                <string>${app}</string>
            </dict>
        </dict>
    </array>
</dict>
</plist>`;

                // 創建 Blob 將 .plist 內容作為臨時文件
                const blob = new Blob([plistContent], { type: 'application/xml' });
                const plistUrl = URL.createObjectURL(blob);

                // 使用 itms-services 觸發安裝
                const installUrl = `itms-services://?action=download-manifest&url=${plistUrl}`;
                window.location.href = installUrl;
            } else {
                // 缺少必要參數時顯示錯誤
                document.body.innerHTML = "<h1>Error: Missing 'app' or 'id' parameters</h1>";
            }
        };
    </script>
</head>
<body>
    <h1>Preparing to Install Your App...</h1>
</body>
</html>
